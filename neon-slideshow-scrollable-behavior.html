<link rel="import" href="../iron-draggable/iron-draggable-behavior.html">
<link rel="import" href="../iron-selector/iron-selectable.html">
<link rel="import" href="../neon-advanced-animations/horizontal-scroll-animation.html">
<link rel="import" href="../neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../polymer/polymer.html">


<script>

  window.Zecat = window.Zecat || {};

  Zecat.NeonSlideshowScrollableBehaviorImpl = {
    properties: {
      centerSlideOnTap: {
        type: Boolean,
        value: false,
        observer: '_centerSlideOnTapChanged'
      },
      centerSlideOnTrackEnd: {
        type: Boolean,
        value: false
      },
      animationConfig: {
        value: function() {
          return {
            'scroll' : {
              name: 'horizontal-scroll-animation',
              node: this,
              shift: 0
            }
          }
        }
      } 
    },

    listeners: {
      'iron-select': '_selectedSlideChange',
      // event fired from iron-draggable-behavior
      'track-end': '_trackEnd'
    },

    centerSlide: function(slide) {
      this.scroll((slide.offsetWidth - this.offsetWidth) / 2 + slide.offsetLeft - this.scrollLeft);
    },
    
    scroll: function(shift) {
      // check for overflow to the left
      if (this.scrollLeft <= -shift) {
        shift = -this.scrollLeft;
      }
      // check for overflow to the right
      if (shift >= (remainingWidth = this.scrollWidth - this.scrollLeft - this.offsetWidth)) {
        shift = remainingWidth;
      }
      this.animationConfig.scroll.shift = shift;
      this.playAnimation('scroll');
    },

    _centerSlideOnTapChanged: function(centerSlideOnTap) {
      this.activateEvent = centerSlideOnTap ? 'tap' : '';
    },

    _selectedSlideChange: function(e, selected)Â {
      this.centerSlide(selected.item);
    },

    _trackEnd: function() {
      // if sroll is at max or min value, do nothing
      if (!this.centerSlideOnTrackEnd
          || !this.scrollLeft 
          || (this.scrollLeft + this.offsetWidth) == this.scrollWidth) {
        return;
      }
      for (slide of this.items) {
        if (this.scrollLeft < slide.offsetLeft) {
          this.centerSlide(slide);
          return;
        }
      }
    }
    
  };

  Zecat.NeonSlideshowScrollableBehavior = [
    Polymer.IronSelectableBehavior,
    Polymer.NeonAnimationRunnerBehavior,
    Zecat.IronDraggableBehavior,
    Zecat.NeonSlideshowScrollableBehaviorImpl
  ];

</script>
